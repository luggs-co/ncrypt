$(function(){var editor;var encryptionInProgress=null;var time_decryption=0;var timer_decrypted=null;function TimeDiff(){var start=new Date;return{getDiff:function(){var end=new Date;return end.getTime()-start}}}function stringBreak(str,col){var result="";for(var i=0;i<str.length;i++){result+=str.charAt(i);if((i+1)%col==0&&0<i){result+="\n"}}return result}function onCodeChange(){if(null!=timer_decrypted){var coloring=timer_decrypted.getDiff();$("#coloring").html("syntax: "+coloring+"ms,");var total=time_decryption+coloring;$("#totaltime").html("total: "+total+"ms")}}function decrypt_update(){$(".cm-s-default").parent().hide();$("#decrypting").hide();var key=window.location.hash.substring(1);var data=$("#data").val();var cipher=$("#cipher").val();if(""==data){$("#askpassword").show();$("#typepassword").focus();return false}else{$("#askpassword").hide()}if(""==key){$("#insertkey").show();$("#typekey").focus();return false}else{$("#insertkey").hide()}$("#decrypting").show();var t=new TimeDiff;var output=window.ezcrypt_backend.decrypt(key,data,cipher);time_decryption=t.getDiff();$("#execute").html("decryption: "+time_decryption+"ms,");$("#wrapholder").show();$(".cm-s-default").parent().show();$("#decrypting").hide();timer_decrypted=new TimeDiff;editor.setOption("mode",$("#syntax").val());editor.setValue(output)}function requestData(){var password=window.ezcrypt_backend.sha($("#typepassword").val());var url=window.location.href;var hash=window.location.hash;var index_of_hash=url.indexOf(hash)||url.length;var hashless_url=url.substr(0,index_of_hash);$.ajax({url:hashless_url,type:"POST",dataType:"json",data:"p="+password,cache:false,success:function(json){$("#data").val(json.data);$("#syntax").val(json.syntax);$("#cipher").val(json.cipher);decrypt_update()},error:function(){alert("bad password!")}})}function encrypt_update(){if(encryptionInProgress!=null){clearTimeout(encryptionInProgress);encryptionInProgress=null}var key=$("#new_key").val();var text=$("#new_text").val();var cipher=$("#new_cipher").val();$("#new_result").html("");$("#new_encrypttime").html("");if(""==key||""==text)return"";var t=new TimeDiff;var encrypt=stringBreak(window.ezcrypt_backend.encrypt(key,text,cipher),96);$("#new_encrypttime").html("encryption: "+t.getDiff()+"ms");$("#new_result").val(encrypt);return encrypt}function encrypt_update_delayed(){if(encryptionInProgress!=null){clearTimeout(encryptionInProgress);encryptionInProgress=null}encryptionInProgress=setTimeout(function(){encryptionInProgress=null;encrypt_update()},500)}function submitData(){if($("#new_text").val()==""){return false}var key=$("#new_key").val();var cipher=$("#new_cipher").val();if(encryptionInProgress!=null||$("#new_result").val()==""){encrypt_update()}$("#en").unbind("mouseenter mouseleave");$("#new_result").show();$("#new_encrypttime").show();var data=$("#new_result").val();var password="";if($("#new_usepassword").is(":checked")){password=window.ezcrypt_backend.sha($("#new_typepassword").val())}var ttl=$("#new_ttl").val();var syntax=$("#new_syntax").val();if(typeof syntax=="undefined"){syntax=$("#syntax").val()}$.ajax({url:document.baseURI,type:"POST",dataType:"json",data:"data="+encodeURIComponent(data)+"&p="+password+"&ttl="+encodeURIComponent(ttl)+"&syn="+encodeURIComponent(syntax)+"&cipher="+encodeURIComponent(cipher),cache:false,success:function(json){if(ttl==-100){}else{var querypw="";if(password!="")querypw="?p="+password;window.location=document.baseURI+"p/"+json.id+querypw+"#"+key}},error:function(){enableHover();alert("error submitting form")}})}if(document.getElementById("content")){window.editor=editor=CodeMirror.fromTextArea(document.getElementById("content"),{lineNumbers:true,matchBrackets:false,lineWrapping:false,readOnly:true,onChange:onCodeChange});editor.setOption("mode",$("#new_syntax").val());editor.focus()}window.ezcrypt_backend.randomKey(function(key){$("#new_key").val(key);var en=$("#en");en.bind("click",submitData);en.removeAttr("disabled");en.val("Submit");var text=$("#new_text");if(""!=text.val())encrypt_update_delayed();text.bind("textchange",encrypt_update_delayed);text.live("keydown",function(e){if(e.keyCode==13&&e.ctrlKey){en.click()}});en.hover(function(){$("#new_result").show();$("#new_encrypttime").show()},function(){$("#new_result").hide();$("#new_encrypttime").hide()})});$("#new_usepassword").change(function(){if(this.checked){$("#new_typepassword").show()}else{$("#new_typepassword").hide()}});if($("#askpassword").length){$("#submitpassword").bind("click",requestData);$("#submitkey").bind("click",function(){window.location=window.location+"#"+$("#typekey").val();decrypt_update()});$("#typepassword,#typekey").live("keydown",function(e){if(e.keyCode==13){$(this).parent().find("input[type=button]").click()}});$("#new").bind("click",function(){$("#new_text").html("");$("#new_result").val("");$("#newpaste").slideDown()});$("#clone").bind("click",function(){$("#new_text").html(editor.getValue()).trigger("textchange");$("#newpaste").slideDown()});$("#tool-wrap").bind("click",function(){var checked=$("#tool-wrap").is(":checked");$(".tool-wrap").toggleClass("tool-wrap-on",checked);editor.setOption("lineWrapping",checked)});$("#tool-numbers").bind("click",function(){var checked=$("#tool-numbers").is(":checked");$(".tool-numbers").toggleClass("tool-numbers-on",checked);editor.setOption("lineNumbers",checked)});$("#tool-fullscreen").bind("click",function(){var checked=$("#tool-fullscreen").is(":checked");$(".tool-fullscreen").toggleClass("tool-fullscreen-on",checked);$("#holder").css("width",checked?"100%":"")});decrypt_update()}window.ezcrypt={sha:window.ezcrypt_backend.sha,encrypt:window.ezcrypt_backend.encrypt,decrypt:window.ezcrypt_backend.decrypt,editor:editor}});
//# sourceMappingURL=core-0.4-1.min.js.map